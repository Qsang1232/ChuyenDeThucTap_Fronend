;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="5681dfbf-6a87-6124-9dcb-8cbcdbb9cd5c")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,5664773,e=>{"use strict";var t=e.i(31889),r=e.i(7553931),a=e.i(2773220),s=e.i(7171047);e.s(["NotificationsButton",0,function(){let e=(0,r.usePathname)();return e?.startsWith("/account")||e?.startsWith("/domains")?null:(0,t.jsx)(a.NotificationsProviderAndPopover,{})},"NotificationsButtonSkeleton",0,function(){return(0,t.jsx)("div",{className:"grid place-content-center size-[30px] rounded-full border border-solid border-gray-300",children:(0,t.jsx)(s.Bell,{})})}])},2938727,e=>{e.v(e.b(["static/chunks/ffc9b54ea7c9022a.js","static/chunks/turbopack-8c5fac0562efdf0b.js"]))},4577993,e=>{"use strict";var t=e.i(31889),r=e.i(6695816),a=e.i(7553931),s=e.i(6143247),n=e.i(57106),i=e.i(4394511),o=e.i(8866156),l=e.i(7420728),c=e.i(3181399),u=e.i(6439983),d=e.i(4585051),p=e.i(9689002),m=e.i(8735244),f=e.i(8216525),h=e.i(1438473),g=e.i(2331152),v=e.i(2259462),y=e.i(2712781),j=e.i(6942035),w=e.i(4240811),b=e.i(2720056),x=e.i(2695633),S=e.i(1903235);let k=(e,t)=>{let r=(0,S.detectScopeType)(e.route);if("unknown"===r)throw Error(`Unknown scope type for route: ${e.route}`);let a={type:r,search:"",hash:"",...e};return{type:"dash",score:0,page:a,params:t,href:(0,S.createHref)(a,t)}},E=e=>({type:"prompt",score:0,href:`prompt:${e}`,query:e}),A=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;for(let r=t;r--;)e.sort(()=>Math.sign(Math.random()-.5));return e},P=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6,r=new Set,a=[],s=0,n=0;for(let i=0;;++i){let o=i%e.length,l=e[o].shift();if(!l){if(++n===e.length)break;continue}let c=a[o];if(c||(c=[],a[o]=c),n=0,r.has(l.href)){--i;continue}if(r.add(l.href),c.push(l),++s===t)break}return a.flat()};var R=e.i(8213147),N=e.i(7837522),L=e.i(7780974),$=e.i(60582);function C(n){let{variant:l="header"}=n,{open:c}=(0,R.useNavDocs)(),{close:d,refresh:f,refreshRef:h,memoryRef:v,fromRef:y,modalRef:w,prompt:b}=(0,o.useFind)(),{track:x}=(0,N.useTrackActivity)(),C=(0,r.useMemo)(()=>{if("sidebar"===l)return"4px";let e=y.current;if(!e)return"32px";let t=Math.max(32,16+window.innerWidth-384-e.getBoundingClientRect().left);return`${Math.round(t)}px`},[y,l]),q=(0,r.useMemo)(()=>{var e;let t,r,a;return P((a=e=v.current,[(e=>{let t=[];e:for(let r of e.recentPreviews)for(let a of r.previews){if(e.params.project&&a.project!==e.params.project)continue;let r=k({route:"/[teamSlug]/[project]/[id]"},{team:e.params.team,project:a.project,id:a.deployment});if(6===t.push(r))break e}return t})(e),(e=>{let t=[];{let r=e.frecency.scopes.find(e=>!e.includes("/")),a="";e.params.team&&"/[teamSlug]"!==e.route?a=e.params.team:r&&(a=r);let s=e.frecency.scopes.find(e=>e.includes("/")),n="",i="";for(let r of(e.params.project?(n=e.params.project,i=e.params.team||a):s&&([i,n]=s.split("/")),e.frecency.routes)){let s;if(r in e.routes){if(r.startsWith("/[teamSlug]/[project]")){if(!n)continue;s={team:i,project:n}}else{if(!a)continue;s={team:a}}t.push(k({route:r},s))}}}if(e.params.project)"/[teamSlug]/[project]"!==e.route?t.push(k({route:"/[teamSlug]/[project]"},{team:e.params.team,project:e.params.project})):t.push(k({route:"/[teamSlug]/[project]/deployments"},{team:e.params.team,project:e.params.project}));else for(let[r]of Array.from(e.projectWeights.entries()).sort((e,t)=>t[1]-e[1])){let a=e.projects.get(r);if(!a||a.owner!==e.params.team)continue;let s=k({route:"/[teamSlug]/[project]"},{team:e.params.team,project:a.name});if(6===t.push(s))break}return e.params.team&&"/[teamSlug]"!==e.route&&t.push(k({route:"/[teamSlug]"},{team:e.params.team})),t})(e),(e=>{let t=[];for(let[r,a]of Object.entries(e.routes)){let s={},n=(0,S.detectScopeType)(r);if("project"===n){if(!e.params.project)continue;s.project=e.params.project,s.team=e.params.team}else if("team"===n){if(!e.params.team)continue;s.team=e.params.team}else if("account"!==n)continue;for(let[e,n]of(a.promote&&t.push(k({route:r},s)),Object.entries(a.search||{})))n.promote&&t.push(k({route:r,search:e},s));for(let[s,n]of Object.entries(a.hash||{}))n.promote&&t.push(k({route:r,hash:s},e.params))}return A(t)})(e),(t=e.routes[e.route],!(r=t?.docs)?[]:[{type:"docs",title:t.label,href:`/docs${r}`,score:0}]),(e=>{let t=[],{project:r,team:a}=e.params;if(a){let a=new Set,s=new Set;for(let t of(r&&(a.add(r),s.add(""),s.add(r)),e.recentPreviews))for(let e of t.previews)a.add(e.project),s.add(e.project);for(let[t,r]of e.projectWeights){if(r<1.1)continue;let n=e.projects.get(t)?.name;n&&(a.add(n),s.add(n))}for(let e of s)t.push(`${e} visitors this week`.trim(),`${e} bounce rate last week`.trim(),`failed requests${e?` on ${e}`:""}`,`finished builds${e?` for ${e}`:""}`,`How do I add another domain${e?` to ${e}`:""}`,`${e} production deployments`.trim(),`${e} visits this morning`.trim()),e&&t.push(`${e} usage`);r&&t.push("how do I set up oidc?","how do I turn on fluid compute?"),t.push("successful production deployments","failing production deployments","queued production deployments","what did we deploy today?","how do I add a domain?")}else t.push("What teams am I on?");return A(t).slice(0,1).map(E)})(e)].map(e=>e.filter(e=>e.href!==a.href))))},[v]),[M,T]=(0,r.useState)([]),[D,B]=(0,r.useState)(0),F=(0,r.useRef)(D);F.current=D;let W=(0,r.useRef)(0),O=(0,r.useRef)(0),z=(0,r.useRef)(void 0);(0,r.useEffect)(()=>{let t,r=new Worker(e.r(2938727));z.current=r;let a="";return r.addEventListener("message",e=>{let r=e.data;if(r.requestId<O.current)return;O.current=r.requestId;let{results:s,permutations:n}=r,i=s;if(a===r.query&&t){i=t.slice();let e=t.filter((e,t)=>t!==F.current&&!s.some(t=>t.href===e.href)),r=s.filter(e=>!t?.some(t=>t.href===e.href));for(let a=0;a<s.length;++a){let s=t[a];if(!s||e.includes(s)){let e=r.shift();if(!e)break;i[a]=e}}}a=r.query,t=i,T(i);let o=()=>{for(let e of n)(0,u.fetchParamPermutation)(e,v.current,f)};(0,S.normalizeParam)(String(r.query.at(-1))).length?K.current=setTimeout(o,250):o()}),()=>{z.current?.terminate(),z.current=void 0}},[v,f]),(0,r.useEffect)(()=>{let e=e=>{"Escape"===e.key&&d()},t=!1,r=e=>{t=!w.current?.contains(e.target)},a=e=>{if(e.metaKey||e.ctrlKey||e.button)return;let r=e.target;if(!w.current?.contains(r)){t&&setTimeout(()=>d());return}r.closest("a[href],button")&&setTimeout(()=>d())};return window.addEventListener("keydown",e),window.addEventListener("pointerdown",r,!0),window.addEventListener("click",a,!0),()=>{window.removeEventListener("keydown",e),window.removeEventListener("pointerdown",r,!0),window.removeEventListener("click",a,!0)}},[d,w]);let K=(0,r.useRef)(0),_=(0,r.useCallback)(e=>{let t=e.target.value;if(!t.trim()){h.current=void 0,O.current=++W.current,T([]);return}clearTimeout(K.current),h.current=()=>{let e={requestId:++W.current,query:t,memory:v.current};z.current?.postMessage(e)},f(),B(0)},[v,h,f]),H=(0,i.useOnNavigate)(),V=(0,a.useRouter)();(0,r.useEffect)(()=>{let e=!1,t=-1,r=()=>{e=!0,-1!==t&&(B(t),t=-1)},a=r=>{let a=r.target;if(!w.current?.contains(a))return;let s=a.closest("a[href],button");if(!s)return;let n=Number(s.dataset.index||-1);-1===n||D!==n&&(e?(B(n),e=!1):t=n)},s=e=>{let{key:t}=e;if("Enter"===t){e.preventDefault(),e.stopPropagation();let t=(M.length?M:q)[D];x(L.VercelActivityAction.FindModalResultSelected,{resultType:t.type,route:"dash"===t.type?t.page.route:void 0,via:"keyboard"}),"prompt"===t.type?b.start(t.query):"docs"===t.type&&window.innerWidth>=960?c(t.href):(H(t.href),V.push(t.href)),d();return}let r=Number("ArrowDown"===t)-Number("ArrowUp"===t);r&&(e.preventDefault(),e.stopPropagation(),B(Math.max(0,Math.min(D+r,(M.length||q.length)-1))))};return window.addEventListener("pointermove",r),window.addEventListener("pointerover",a),window.addEventListener("keydown",s),()=>{window.removeEventListener("pointermove",r),window.removeEventListener("pointerover",a),window.removeEventListener("keydown",s)}},[V,d,M,q,D,w,b,c,H,x]),(0,r.useEffect)(()=>()=>{h.current=void 0},[h]),(0,r.useLayoutEffect)(()=>{if(window.innerWidth<=600||matchMedia("(prefers-reduced-motion: reduce)").matches)return;let e=y.current,t=w.current;if(e&&t){let r,a,s,n;(r=t.closest("[data-backdrop]"))&&r.animate([{backgroundColor:"transparent"},{}],{duration:300,easing:"ease"}),(()=>{let r=e.querySelector("[data-search-icon] > *"),a=t.querySelector("[data-search-icon] > *");if(!r||!a||a.getAnimations().length)return;let s=r.getBoundingClientRect(),n=a.getBoundingClientRect();a.animate([{transform:`translateX(${s.left-n.left}px)`},{transform:"none"}],{duration:150,easing:"ease"})})(),(()=>{let r=t.querySelector("[data-bg-layer]");if(!r||r.getAnimations().length)return;let a=e.getBoundingClientRect(),s=r.getBoundingClientRect();r.animate([{transform:`translate(${a.left-s.left}px,${a.top-s.top}px) scale(${a.width/s.width},${a.height/s.height})`},{transform:"none"}],{duration:150,easing:"ease"})})(),(()=>{let r=e.querySelector("[data-placeholder]"),a=t.querySelector("input");if(!r||!a||a.getAnimations().length)return;let s=r.getBoundingClientRect(),n=a.getBoundingClientRect();a.animate([{transform:`translateX(${s.left-n.left}px)`},{transform:"none"}],{duration:150,easing:"ease"})})(),(a=t.querySelector("label"))&&!a.getAnimations().length&&a.animate([{borderBottomColor:"transparent"},{}],{delay:50,duration:250,easing:"ease",fill:"backwards"}),(s=t.querySelector("[data-results-list]"))&&!s.getAnimations().length&&s.animate([{opacity:"0"},{}],{delay:50,duration:250,easing:"ease",fill:"backwards"}),(n=t.querySelector("kbd"))&&!n.getAnimations().length&&n.animate([{opacity:"0",transform:"translateX(-20%) scale(0.95)"},{}],{delay:50,duration:250,easing:"ease",fill:"backwards"})}},[y,w]);let G=!!(M.length&&v.current.pendingPermutations.size);return(0,t.jsx)("div",{className:(0,s.cn)("fixed inset-0 z-[10000]",$.IS_DASH?"bg-background-100 md:bg-background-100/60":"bg-background-100/60"),"data-backdrop":!0,children:(0,t.jsx)("div",{className:(0,s.cn)("fixed inset-0 flex flex-col items-center justify-start","header"===l&&"md:items-end md:pr-[var(--x-offset)] md:pt-2","sidebar"===l&&"md:items-start md:pl-[var(--x-offset)] md:pt-[calc(var(--navbar-height)-6px)]"),style:{"--x-offset":C},children:(0,t.jsx)("div",{className:(0,s.cn)("h-screen w-screen md:h-[384px] md:max-w-96 md:p-0",$.IS_DASH?"p-0":"p-2"),children:(0,t.jsxs)("div",{className:"relative flex flex-col",ref:w,children:[(0,t.jsx)("div",{className:(0,s.cn)("absolute -inset-px origin-top-left",$.IS_DASH?"md:material-modal":"material-modal"),"data-bg-layer":!0}),(0,t.jsxs)("label",{className:(0,s.cn)("relative flex flex-row items-center border-0 border-b border-solid border-gray-300"),children:[(0,t.jsx)("div",{className:"grid size-12 place-content-center","data-search-icon":!0,children:(0,t.jsx)(g.MagnifyingGlass,{color:"gray-900"})}),(0,t.jsx)("input",{className:"text-copy-14 h-12 flex-1 border-0 border-none bg-transparent py-4 pl-0 pr-4 outline-none",onChange:_,placeholder:"Find…",ref:e=>{e?.focus()},width:"100%"}),(0,t.jsx)("button",{"aria-label":"Close",className:"grid size-12 cursor-pointer place-content-center border-none bg-transparent outline-none",onClick:()=>d(),type:"button",children:G?(0,t.jsx)(m.Spinner,{className:"animate-partial-fade-in"}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(p.Kbd,{className:"!ml-0 mr-1.5 pointer-coarse:hidden",small:!0,children:"Esc"}),(0,t.jsx)(j.Cross,{className:"pointer-fine:hidden",color:"gray-900"})]})})]}),(0,t.jsx)("div",{className:"relative h-[18.5rem] overflow-y-auto overflow-x-clip md:overflow-y-clip","data-results-list":!0,children:(0,t.jsxs)("div",{className:"flex flex-col p-1",children:[(M.length?M:q).map((e,r)=>(0,t.jsx)(I,{index:r,result:e,memory:v.current},e.href)),(0,t.jsx)("div",{className:"pointer-events-none absolute inset-x-1 top-1 h-12 rounded bg-gray-alpha-100",style:{transform:`translateY(${3*D}rem)`,transition:"transform 0.1s ease"}})]})})]})})})})}function I(e){let{index:r,memory:a,result:s}=e,{label:n,icon:i,prefix:o,avatar:l}=D(s,a),c=B(s,a);return(0,t.jsxs)(q,{className:"flex h-12 flex-none flex-row items-center rounded p-0 active:bg-gray-100",index:r,result:s,children:[(0,t.jsx)("span",{"aria-hidden":!0,className:"grid size-11 flex-none place-content-center",children:(0,t.jsxs)("div",{className:"relative",children:[o||(0,t.jsx)(i,{color:"gray-900"}),l?(0,t.jsx)("div",{className:"absolute left-full top-full -ml-2 -mt-2 grid size-auto place-content-center rounded-full bg-background-100 p-0.5",children:l}):null]})}),(0,t.jsxs)("div",{className:"flex flex-1 select-none flex-col overflow-hidden pr-2",children:[(0,t.jsx)("div",{className:"text-label-13 h-4 truncate",children:(0,t.jsx)("strong",{children:n})}),(0,t.jsx)("div",{className:"text-label-13 h-4 truncate text-gray-900",children:c})]})]})}function q(e){let{className:r,index:a,result:s,children:n}=e;return"prompt"===s.type?(0,t.jsx)(T,{className:r,index:a,result:s,children:n}):(0,t.jsx)(M,{className:r,index:a,result:s,children:n})}function M(e){let{className:a,index:s,result:i,children:o}=e,{open:l}=(0,R.useNavDocs)(),{track:c}=(0,N.useTrackActivity)(),u="dash"===i.type?i.page.route:void 0,d=(0,r.useCallback)(e=>{c(L.VercelActivityAction.FindModalResultSelected,{resultType:i.type,route:u,via:"pointer"}),"docs"!==i.type||e.button||e.ctrlKey||e.metaKey||window.innerWidth<960||(l(i.href),e.preventDefault())},[l,i.href,i.type,c,u]);return(0,t.jsx)(n.Link,{className:a,"data-index":s,href:i.href,onClick:d,tab:"docs"===i.type,children:o})}function T(e){let{className:a,index:n,result:i,children:l}=e,{prompt:c}=(0,o.useFind)(),{track:u}=(0,N.useTrackActivity)(),d=(0,r.useCallback)(()=>{u(L.VercelActivityAction.FindModalResultSelected,{resultType:i.type,via:"pointer"}),c.start(i.query)},[i.query,i.type,c,u]);return(0,t.jsx)("button",{className:(0,s.cn)("cursor-pointer border-none bg-transparent text-left outline-none",a),"data-index":n,onClick:d,type:"button",children:l})}let D=(e,r)=>{let a;switch(e.type){case"prompt":return{icon:y.Sparkles,label:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"text-gray-900",children:"“"}),e.query,(0,t.jsx)("span",{className:"text-gray-900",children:"”"})]})};case"docs":return{icon:v.File,label:e.title};case"dash":{let s,n=l.Routes[e.page.route],i=n;e.page.search&&(i=i.search[e.page.search]),e.page.hash&&(i=i.hash[e.page.hash]);let o="",u=e.params.team===r.params.team,p=e.params.project===r.params.project,m=u&&(p||!e.params.project),g=r.teams.get(e.params.team||"");g&&(a=e=>(0,t.jsx)(d.Avatar,{hash:g.avatar,size:e,teamId:g.id}));let v=e.params.project||"",y=r.slugs.get(e.params.team||"")?.get(v);if(y&&(a=r=>(0,t.jsx)(b.ProjectAvatar,{error:(0,t.jsx)(w.ChevronCircleRightFill,{size:Math.min(r,16),color:"gray-900"}),teamId:e.params.team,project:{id:y,name:v},size:r})),"/[teamSlug]"===e.page.route)g&&(o=g.name);else if("/[teamSlug]/[project]"===e.page.route)o=v;else if("deployment"===e.page.type){let n=e.params.id||"",i=r.deployments.get(n);if(i&&(a&&!m?(s=a(21),a=()=>(0,t.jsx)(f.DeploymentStatus,{deployment:i})):s=(0,t.jsx)(f.DeploymentStatus,{deployment:i})),"/[teamSlug]/[project]/[id]"===e.page.route){if(F(e,r))o="Production Deployment";else if(i){let e=(0,x.getGitMeta)(i.meta);e?.branchName&&(o=e.branchName)}}}return a&&(i?.label==="Overview"?(s=a(21),a=void 0):m&&(a=void 0)),{avatar:a?.(12),icon:c.RouteIcons[i?.label||""]??c.RouteIcons[n?.label||""]??c.RouteIcons[i?.group||""]??c.RouteIcons[n?.group||""]??(a?w.ChevronCircleRightFill:h.ArrowRight),prefix:s,label:o||i?.label||W(e.page.route)}}}},B=(e,t)=>(0,r.useMemo)(()=>{switch(e.type){case"prompt":return"Navigation Assistant";case"docs":return"Documentation"}let r=[],a=!1,s=e.params.team||"",n=e.params.project||"";if(s&&s===t.params.team||"/[teamSlug]"===e.page.route?r.push("Team"):e.params.team&&(r.push(t.teams.get(s)?.name||"Team"),a=!0),n&&n===t.params.project?(r.splice(0),r.push("Project")):"/[teamSlug]/[project]"===e.page.route?a||(r.splice(0),r.push("Project")):n&&(s===t.params.team&&r.splice(0),r.push(n),a=!0),"deployment"===e.page.type)if(F(e,t)||a);else if("/[teamSlug]/[project]/[id]"===e.page.route)r.splice(0),r.push("Latest Deployment");else{let a=t.deployments.get(e.params.id||""),s=(0,x.getGitMeta)(a?.meta);r.splice(0),s?.branchName?r.push(s.branchName):r.push("Deployment")}else e.params.id&&(r.splice(0),r.push("Deployment"));if(!a){let t=l.Routes[e.page.route];t&&((e.page.search||e.page.hash)&&r.push(t.label),t.group&&t.group!==t.label&&r.push(t.group))}return r.join(" / ")||""},[e,t]),F=(e,t)=>"dash"===e.type&&t.projectDeployments.get(e.params.project||"")?.id.replace("dpl_","")===e.params.id,W=e=>{let t=e.split("/").pop();return!t||t.startsWith("[")?"":t.replace(/(?:^|-)(?<word>.*?)(?=-|$)/g,(e,t)=>`${t.substring(0,1).toUpperCase()}${t.substring(1)}`)};e.s(["FindModal",0,function(e){let{variant:r}=e,{isOpen:a}=(0,o.useFind)();return a?(0,t.jsx)(C,{variant:r}):null}],4577993)},7622583,e=>{"use strict";var t=e.i(6695816),r=e.i(7553931),a=e.i(7909933),s=e.i(9171423),n=e.i(8042625),i=e.i(5338940),o=e.i(2686817),l=e.i(6161994),c=e.i(2695633),u=e.i(8866156),d=e.i(7497619),p=e.i(1903235);e.i(7962980);class m{name;onInit;version;constructor({name:e,init:t,version:r}){this.name=e,this.onInit=t,this.version=r}open(){return"indexedDB"in globalThis?new Promise((e,t)=>{let r=globalThis.indexedDB.open(this.name,this.version);r.addEventListener("upgradeneeded",e=>{let t=e.target;this.onInit(t.result,e)}),r.addEventListener("error",e=>{let r=e.target;t(Error(r.error?.message))}),r.addEventListener("success",t=>{e(t.target.result)})}):Promise.reject("IndexedDB is not supported in this context")}async store(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"readwrite";return(await this.open()).transaction(e,t).objectStore(e)}get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((r,a)=>{"object"==typeof t?this.getAll(e,{...t,limit:1}).then(e=>r(e[0])):this.store(e,"readonly").then(e=>{let s=e.get(t);s.addEventListener("success",e=>{r(e.target.result)}),s.addEventListener("error",e=>{let t=e.target;a(Error(t.error?.message))})})})}getKey(e,t){return new Promise((r,a)=>{this.store(e,"readonly").then(e=>{let s=e.index(t.index).getKey(t.query);s.addEventListener("success",e=>{r(e.target.result)}),s.addEventListener("error",e=>{let t=e.target;a(Error(t.error?.message))})})})}getAll(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((r,a)=>{(async()=>{let s,n=await this.store(e,"readonly");t.index&&(n=n.index(t.index)),(s=t.query?n.getAll(t.query,t.limit):n.getAll(null,t.limit)).addEventListener("success",e=>{r(e.target.result)}),s.addEventListener("error",e=>{let t=e.target;a(Error(t.error?.message))})})()})}async iterateOver(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=await this.store(e,"readonly");return r.index&&(a=a.index(r.index)),new Promise((e,s)=>{let n;(n=r.query?a.openCursor(r.query,r.direction):a.openCursor(null,r.direction)).addEventListener("success",async r=>{let a=r.target?.result;a&&!1!==await t(a.value)?a.continue():e()}),n.addEventListener("error",e=>{let t=e.target;s(Error(t.error?.message))})})}async take(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=[];return await this.iterateOver(e,e=>r.push(e)!==t.limit,t),r}add(e,t){return new Promise((r,a)=>{this.store(e).then(e=>{let s=e.add(t);s.addEventListener("success",e=>{r(e.target.result)}),s.addEventListener("error",e=>{let t=e.target;a(Error(t.error?.message))})})})}put(e,t){return new Promise((r,a)=>{this.store(e).then(e=>{let s=e.put(t);s.addEventListener("success",e=>{r(e.target.result)}),s.addEventListener("error",e=>{let t=e.target;a(Error(t.error?.message))})})})}async set(e,t){let r=t[(await this.store(e)).keyPath];if(!r)throw Error(`Cannot set an object in store "${e}" without an id`);await this.get(e,r)?await this.put(e,t):await this.add(e,t)}delete(e,t){return new Promise((r,a)=>{this.store(e).then(e=>{let s=e.delete(t);s.addEventListener("success",()=>{r()}),s.addEventListener("error",e=>{let t=e.target;a(Error(t.error?.message))})})})}clear(){return indexedDB.deleteDatabase(this.name)}}let f=(e,t)=>{h(e.createObjectStore(t.name,{keyPath:t.keyPath??"id"}),t.props)},h=(e,t)=>{for(let r of t)e.createIndex(r,r)},g=()=>new m({name:"vcf-frecency",version:1,init:(e,t)=>{t.oldVersion<1&&(f(e,{name:"Routes",props:["route","visits","updatedAt"],keyPath:"route"}),f(e,{name:"Scopes",props:["scope","team","project","visits","updatedAt"],keyPath:"scope"}))}});var v=e.i(7420728);let y="requestIdleCallback"in globalThis?requestIdleCallback:setTimeout,j=async(e,t,r)=>{try{let a=g(),s=new Date,n=await a.get("Routes",e);n||(n={route:e,visits:0,updatedAt:s}),++n.visits,n.updatedAt=s,await a.set("Routes",n);let i=r?`${t}/${r}`:t,o=await a.get("Scopes",i);o||(o={scope:i,team:t,project:r,visits:0,updatedAt:s}),++o.visits,o.updatedAt=s,await a.set("Scopes",o)}catch(e){}},w=(e,t)=>{let r=e.reduce((e,t)=>e+t.visits,0),a=new Map;for(let e of t)a.set(e,e.updatedAt.valueOf());let s=e.map(e=>[e,Math.round(3*e.visits/r)]);return s.sort((e,t)=>t[1]-e[1]||(a.get(t[0])||0)-(a.get(e[0])||0)||t[0].visits-e[0].visits),s.map(e=>e[0])},b=async()=>{try{let e=g(),[t,r,a,s]=await Promise.all([e.take("Routes",{index:"visits",direction:"prev",limit:10}),e.take("Routes",{index:"updatedAt",direction:"prev",limit:10}),e.take("Scopes",{index:"visits",direction:"prev",limit:10}),e.take("Scopes",{index:"updatedAt",direction:"prev",limit:10})]),n=w(t,r).map(e=>e.route),i=w(a,s).map(e=>e.scope);return{routes:n,scopes:i}}catch(e){return{routes:[],scopes:[]}}};var x=e.i(6190050);let S=(e,t)=>`${e}${t?(0,n.encode)(t):""}`;class k{db;constructor(){this.db=new m({name:"vcf-cache",version:1,init:(e,t)=>{var r;t.oldVersion<1&&(r={name:"Routes",props:["key","route","version","updatedAt"],keyPath:"key"},((e,t)=>{for(let r of t)e.createIndex(r,r)})(e.createObjectStore(r.name,{keyPath:r.keyPath??"id"}),r.props))}})}async get(e){try{let t=S(e.route,e.params),r=await this.db.get("Routes",t);if(r?.version!==1)return null;return r.data}catch(e){return null}}async list(e){try{return(await this.db.take("Routes",{index:"route",query:e.route,direction:"prev",limit:e.limit})).filter(t=>t.version===e.version).map(e=>e.data)}catch(e){return[]}}async set(e){try{let t=S(e.route,e.params);await this.db.put("Routes",{key:t,route:e.route,version:e.version,params:e.params,data:e.data,updatedAt:new Date})}catch(e){}}clear(){try{this.db.clear()}catch(e){}}}let E=()=>new k;var A=e.i(9611727);e.s(["SearchMemorySync",0,function(){let e,m,f,{memoryRef:h,refresh:g}=(0,u.useFind)(),w=(0,r.useParams)(),S=w?.teamSlug;S!==h.current.params.team&&(h.current.isLoadingProjects=!0),(0,t.useEffect)(()=>{let e=h.current,t=E();(async()=>{let r=await t.get({route:"teams",version:1});if(r)for(let t of r)e.teams.set(t.slug,t),e.teamIds.set(t.id,t.slug);for(let r of(await t.list({route:"projects",version:2})).flat())e.projectWeights.set(r.id,r.isFavorite?1.1:1.01),(0,p.addProject)(e,r);g()})()},[h,g]),(0,t.useEffect)(()=>{if(!S)return;let e=h.current;e.mfe.clear(),(async()=>{e.isLoadingProjects=!0;let t=await (0,s.fetchApi)(`/api/v2/dashboard/projects${(0,n.encode)({favorites:1,teamId:S,limit:25})}`,{throwOnHTTPError:!1});if(e.isLoadingProjects=!1,!t||"object"!=typeof t)return;for(let r of t.projects||[])(0,p.addProject)(e,r),e.projectWeights.set(r.id,1.01);let r=new Set;for(let a of t.favorites||[])e.inferred.project||(e.inferred.project=a.name),(0,p.addProject)(e,a),e.projectWeights.set(a.id,1.1),r.add(a.id);if(e.inferred.project||(e.inferred.project=t.projects?.[0]?.name),g(),!t.projects)return;let a=e.teams.get(S)?.id;a&&E().set({route:"projects",params:{team:S},version:2,data:t.projects.map(e=>({ownerId:a,id:e.id,name:e.name,domain:e.domain||"",framework:e.framework||"",createdAt:0,updatedAt:e.updatedAt,isFavorite:r.has(e.id)}))})})()},[h,g,S]);let k=(0,t.useCallback)(async()=>{h.current.frecency=await b()},[h]);(0,t.useEffect)(()=>void k(),[k]);let P=((e=(0,t.useRef)(k)).current=k,m=(0,t.useRef)(void 0),f=(0,t.useRef)(0),(0,t.useCallback)(function(){for(var t=arguments.length,r=Array(t),a=0;a<t;a++)r[a]=arguments[a];if(clearTimeout(f.current),!(e=>{if(!(e in v.Routes)||e.startsWith("/[teamSlug]/~/account"))return!1;let t=new Set(Array.from(e.matchAll(/\[(?<param>.*?)\]/g)).map(e=>e[1]));if(!t.size)return!1;for(let e of t)if("teamSlug"!==e&&"project"!==e)return!1;return!0})(r[0])){let t=m.current;if(!t)return;m.current=void 0,y(()=>{j(...t).then(()=>e.current?.())});return}m.current=r,f.current=setTimeout(()=>{j(...r).then(()=>e.current?.()),m.current=void 0},3e4)},[])),R=(0,x.useRoute)(),N=(0,r.useSearchParams)();(0,t.useEffect)(()=>{if(!R||!w)return;let e="/"!==h.current.href&&h.current.route!==R;h.current.route=R,h.current.href=`${location.pathname}${location.search}${location.hash}`;let t=d.RouteFilters[R];t&&N?h.current.filters=t.decode(Object.fromEntries(N.entries())):h.current.filters={},g(),e&&P(R,w.teamSlug,w.project||null)},[R,N,h,g,P,w]);let L=(0,i.useSortedTeams)();(0,t.useEffect)(()=>{for(let e of L){let t=h.current;t.teams.set(e.slug,e),t.teamIds.set(e.id,e.slug)}g(),E().set({route:"teams",version:1,data:L})},[h,g,L]);let $=function(e){let{data:r}=(0,a.default)(e?(0,o.swrRequest)(`/api/recents${(0,n.encode)({type:"preview",teamId:e,hydrateLimit:30,limit:7})}`):"",async e=>{if(!e)return[];let t=await (0,s.fetchApi)(e);return Array.isArray(t)?t.filter(e=>e.payload.items.length>0):[]},{revalidateIfStale:!1,revalidateOnFocus:!0});return(0,t.useMemo)(()=>r||[],[r])}(S);(0,t.useEffect)(()=>{let e=h.current;for(let t of(e.recentPreviews.splice(0),$)){let r=t.payload.items,a=r[0];if(!a)continue;let s=(0,c.getGitMeta)(a.deployment.meta),n={branch:s?.branchName||"",commit:s?.commitMessage||"",pr:a.prMetadata,previews:[]};for(let t of(e.recentPreviews.push(n),r)){if(t!==a&&"CANCELED"===t.deployment.readyState)continue;let r=t.deployment.id.replace("dpl_","");n.previews.push({project:t.project.name,deployment:r}),e.deployments.set(r,t.deployment),e.projects.has(t.project.name)||(0,p.addProject)(e,t.project);let s={projectId:t.project.id,project:t.project.name,branch:n.branch,deployment:r};e.activeBranches.set(`${t.project.id}_${n.branch}`,s)}}},[h,g,$]);let{data:C}=(0,l.useMicrofrontendsGroups)();return(0,t.useEffect)(()=>{if(!C)return;let e=h.current,t=e.params.team;if(t){for(let{group:r,projects:a}of C.groups)for(let s of(e.mfe.set(r.name,a.map(e=>e.name)),a))e.projects.set(s.id,{owner:t,name:s.name});g()}},[h,g,C]),(0,t.useEffect)(()=>{if(!w)return;let e=h.current;e.params.team=w.teamSlug,e.params.project=w.project,e.params.id=w.id,A.PRESERVED_PARAMS.forEach(t=>{e.params[t]=w[t]}),e.inferred.team=w.teamSlug,w.project&&(e.inferred.project=w.project),g()},[h,w,g]),null}],7622583)}]);

//# debugId=5681dfbf-6a87-6124-9dcb-8cbcdbb9cd5c
//# sourceMappingURL=d40fdc7392665e53.js.map