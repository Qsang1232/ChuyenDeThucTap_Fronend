;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="cfa57f2c-a41c-7ca0-409e-d8c1c02414a4")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,2831393,e=>{"use strict";var a=e.i(7909933),t=e.i(5338940);e.s(["useAiCreditsBalance",0,function(){let{team:e,isReady:i}=(0,t.useTeam)(),{data:r,isLoading:n,mutate:l}=(0,a.default)(e?.id&&i?`/api/ai/ai-credits-balance?teamId=${e.id}`:null,e=>fetch(e).then(e=>e.json()));return{balance:r?Number(r.cumulativeBalance):void 0,hasEverPaid:r?.hasEverPaid,hasVerifiedPaymentMethod:r?.hasVerifiedPaymentMethod,loading:!i||n,mutate:l}}])},7612113,9602070,1080526,e=>{"use strict";var a=e.i(31889),t=e.i(6695816),i=e.i(2831393),r=e.i(2504781),n=e.i(4030453),l=e.i(6891161),s=e.i(8522580),o=e.i(455575),d=e.i(5338940),c=e.i(5140444);e.i(3512434);var u=e.i(9835407),m=e.i(7917902),p=e.i(6352514),g=e.i(4759942);(0,e.i(7432042).default)("1y");var f=e.i(7909933),x=e.i(5005834);e.i(4373123);var h=e.i(5325056),y=e.i(3559248);let b=(0,y.createServerReference)("40fae0025aeec9a25ccbacf4fb759a1ac350888ccb",y.callServer,void 0,y.findSourceMapURL,"createTopUpPurchaseIntent"),v=u.z.object({amount:u.z.number().min(10).max(5e3)}),C=[20,50,100,500];function j(e){let{activeModalType:u,setActiveModalType:y,closeModal:j,autoRechargeConfig:S,isAutoRechargeEnabled:M}=e,{setPurchaseIntent:A,setProviderDetails:w}=(0,h.useCopperClient)(),{data:B}=(0,f.default)("deferred-auto-recharge-config",{fallbackData:null}),{balance:k}=(0,i.useAiCreditsBalance)(),[N,I]=(0,t.useState)("100"),[R,_]=(0,t.useState)(!1),[T,P]=(0,t.useState)(null),[$,E]=(0,t.useState)("ready"),O=""===N||"0"===N,U=Number(N),z=O||Number.isNaN(U)?100:U,{team:D}=(0,d.useTeam)(),{user:F}=(0,c.useUser)(),{account:G}=(0,m.useAccount)(),H=(0,o.useToasts)(),L=(0,t.useCallback)(e=>{let a=e;e.includes(".")?1===e.split(".")[1].length&&(a=`${e}0`):a=`${e}.00`;let t=Number.parseFloat(a);return Number.isNaN(t)||t<10?(P("Minimum amount is $10"),!1):t>5e3?(P(`Maximum amount is $${5e3.toLocaleString()}`),!1):(P(null),t)},[]),W=(0,t.useCallback)(e=>{I(e),P(null),E("ready")},[]),K=(0,t.useMemo)(()=>S&&B||S?`Auto-reload is enabled. Your balance will be restored to $${S.targetBalance} when it falls below $${S.minimumBalance}.`:B?"Auto-reload will be enabled after your first purchase.":"Auto-reload is disabled.",[S,B]),V=(0,t.useCallback)(async()=>{try{if(!F||!D)return;let e=L(N);if(!e)return;E("in_progress");let a=v.safeParse({amount:e});if(!a.success){a.error.issues[0],e<10?E("amount_too_low"):e>5e3?E("amount_too_high"):E("invalid_amount");return}let t=await b({amount:N,returnUrl:window.location.href,teamIdOrSlug:D.id});E("completed"),A(t.purchaseIntent),w(t.providerDetails),y("checkout")}catch(e){H.error("We're having trouble processing your payment. Please try again."),E("ready"),A(null),w(null),j(),g.analytics.track(p.AnalyticsEvent.AI_CREDITS_CHECKOUT_ERROR,{message:e.message})}},[N,F,D,G,j,A,w,y,L,H]);return(0,a.jsxs)(l.Modal.Modal,{active:"top_up"===u,onClickOutside:j,children:[(0,a.jsxs)(l.Modal.Body,{children:[(0,a.jsxs)(l.Modal.Header,{children:[(0,a.jsx)(l.Modal.Title,{children:"Buy AI Gateway Credit"}),(0,a.jsx)(l.Modal.Subtitle,{children:"Purchase credit as a one time top-up to use for your team's AI Gateway usage. Credit expires 1 year after purchase and is only valid for use on AI Gateway."})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsxs)("div",{className:"flex flex-col items-center gap-4 pb-4",children:[(0,a.jsx)("div",{className:"flex h-[84px] items-center justify-center text-gray-1000",children:R?(0,a.jsxs)("div",{className:"flex items-center justify-center w-full transition-transform duration-200 animate-in zoom-in-95",children:[(0,a.jsx)("span",{className:"text-heading-64 text-gray-1000",children:"$"}),(0,a.jsx)("input",{type:"text",value:N.startsWith("$")?N.slice(1):N,onChange:e=>{let a=e.target.value.replace(/,/g,"").replace(/[^0-9.]/g,"");a.split(".")[0].length>6||W(a)},onBlur:()=>{N&&""!==N||I("100"),_(!1)},autoFocus:!0,className:"text-heading-64 text-start border-none outline-none",style:{width:`${Math.max(3,N.length)}ch`},placeholder:"100"})]}):(0,a.jsx)("div",{className:"flex w-full items-center justify-center transition-transform duration-200 animate-in zoom-in-105 cursor-pointer hover:scale-105",onPointerDown:e=>{e.preventDefault(),_(!0),I(z.toString())},children:(0,a.jsx)(x.default,{className:"text-heading-64 text-gray-1000 cursor-pointer",value:z,format:{style:"currency",currency:"USD"}})})}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center justify-center gap-2",children:[C.map(e=>(0,a.jsxs)(r.Button,{size:"small",type:"secondary",normalStyle:N===e.toString()?{backgroundColor:"var(--ds-gray-100)",color:"var(--ds-gray-1000)",borderColor:"var(--ds-gray-alpha-300)"}:void 0,onClick:()=>{I(e.toString()),_(!1),P(null),E("ready")},children:["$",e]},e)),(0,a.jsx)(r.Button,{size:"small",type:"secondary",onClick:()=>{_(!0)},normalStyle:C.map(e=>e.toString()).includes(N)?void 0:{backgroundColor:"var(--ds-gray-100)",color:"var(--ds-gray-1000)",borderColor:"var(--ds-gray-alpha-300)"},children:"Custom"})]})]}),T&&(0,a.jsx)(n.Error,{children:T}),M?(0,a.jsx)(s.Note,{action:(0,a.jsx)(r.Button,{size:"small",type:"secondary",onClick:()=>{y("auto_recharge")},children:"Change"}),fill:!0,type:"secondary",children:K}):null]})]}),(0,a.jsxs)(l.Modal.Actions,{children:[(0,a.jsx)(l.Modal.Action,{onClick:()=>y(null),type:"secondary",children:"Cancel"}),(0,a.jsx)(l.Modal.Action,{onClick:V,disabled:O||!!T,loading:"in_progress"===$,autoFocus:!0,children:"Continue to Payment"})]})]})}var S=e.i(7418514),M=e.i(1637825),A=e.i(5323212),w=e.i(5255926),B=e.i(6446781),k=e.i(5757634),N=e.i(5895979),I=e.i(5883567),R=e.i(57106);let _=(0,y.createServerReference)("40cffaac2aa73d4bc6e207d8078056a377291cb773",y.callServer,void 0,y.findSourceMapURL,"completePurchaseIntent"),T=(0,y.createServerReference)("40723a0db21593670ea87ebaa4d4fd1b3d53b391ee",y.callServer,void 0,y.findSourceMapURL,"confirmPurchaseIntent"),P=(0,y.createServerReference)("40a9c4151d9cb0a13d1393c5356a6467fbd2298b70",y.callServer,void 0,y.findSourceMapURL,"createAutoTopupConfig"),$=(0,y.createServerReference)("40791ed99e9d2858c85ad294b35dc18667a4d58ed5",y.callServer,void 0,y.findSourceMapURL,"patchPaymentMethod");var E=e.i(5906067),O=e.i(6280036),U=e.i(5978870);let z=(0,N.withBillingContext)(function(e){let{activeModalType:n,setActiveModalType:s,closeModal:u,providerDetails:f,onConversion:x}=e,{purchaseIntent:y}=(0,h.useCopperClient)(),[b,v]=(0,t.useState)("ready"),[C,j]=(0,t.useState)(null),{team:w}=(0,d.useTeam)(),{user:N}=(0,c.useUser)(),{mutate:R}=(0,k.useSWRConfig)(),{account:T}=(0,m.useAccount)(),{paymentMethods:P}=(0,M.useBillingPlatform)(),{balance:O,hasEverPaid:U}=(0,i.useAiCreditsBalance)(),z=(0,E.useStripe)(),D=(0,o.useToasts)(),F=(0,t.useMemo)(()=>{if(P){if(!C){let e=P.defaultSource;return P.sources.find(a=>a.id===e)}return P.sources.find(e=>e.id===C)}},[P,C]),W=(0,t.useMemo)(()=>K(y),[y]),V=(0,t.useCallback)(async()=>{try{if(v("in_progress"),!w||!z||!F||!N||!y||!f||void 0===O||void 0===W)return;F.billing_details.email||await $({paymentMethodId:F.id,teamIdOrSlug:w.id});let e=await z.initCheckout({fetchClientSecret:()=>Promise.resolve(f.clientSecret)}),a=await e.confirm({redirect:"if_required",paymentMethod:F.id});if("error"===a.type){g.analytics.track(p.AnalyticsEvent.AI_CREDITS_CHECKOUT_ERROR,{message:a.error.message}),D.error("Failed to add funds. Please try again."),v("ready");return}await _({purchaseIntentId:y.id,teamIdOrSlug:w.id}),D.success(`Successfully added $${W} to your AI Gateway Credits balance!`);let t=Number(O)+W;x?.({amount:W,newBalance:t}),await R(`/api/ai/ai-credits-balance?teamId=${w.id}`,()=>({cumulativeBalance:t,hasEverPaid:!0}),{revalidate:!1}),v("completed"),u()}catch(e){D.error("We're having trouble processing your payment. Please try again."),v("ready"),u(),g.analytics.track(p.AnalyticsEvent.AI_CREDITS_CHECKOUT_ERROR,{message:e.message})}},[N,w,T,z,F,y,R,v,f,D,u,W,O,U,x]);return(0,a.jsxs)(l.Modal.Modal,{active:"checkout"===n,onClickOutside:u,children:[(0,a.jsxs)(l.Modal.Body,{children:[(0,a.jsxs)(l.Modal.Header,{children:[(0,a.jsx)(l.Modal.Title,{children:"Confirm Payment Method"}),(0,a.jsx)(l.Modal.Subtitle,{children:"Your default payment method will be used for a one-time charge unless you add a new payment method below."})]}),(0,a.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial",children:[(0,a.jsx)(A.Select,{label:"Payment method",prefix:(0,a.jsx)(S.CardIcon,{brand:F?.card?.brand??"unknown"}),value:F?.id,onChange:e=>{v("ready"),j(e.target.value)},children:P?.sources.map(e=>(0,a.jsx)("option",{value:e.id,children:`${(0,B.cardBrand)(e.card?.brand)} ${e.card?.funding} ending in •••• ${e.card?.last4} ${e.id===P.defaultSource?"(Default)":""}`},e.id))}),(0,a.jsx)(r.Button,{type:"secondary",size:"medium",prefix:(0,a.jsx)(I.PlusCircle,{}),onClick:()=>{s("add_card")},children:"Add payment method"})]}),(0,a.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial -mx-6 -mb-6 mt-6 px-6 py-4 pt-6 border-t bg-background-200",children:[(0,a.jsx)(L,{}),(0,a.jsx)(G,{purchaseIntent:y})]})]}),(0,a.jsx)("div",{className:"flex flex-col items-stretch justify-start flex-initial px-6 py-2 border-t bg-background-200",children:(0,a.jsx)(H,{purchaseIntent:y})}),(0,a.jsxs)(l.Modal.Actions,{children:[(0,a.jsx)(l.Modal.Action,{onClick:()=>{s("top_up")},type:"secondary",children:"Back"}),(0,a.jsx)(l.Modal.Action,{onClick:async()=>{await V()},loading:"in_progress"===b,children:"Confirm and Pay"})]})]})});function D(e){var r,n;let{activeModalType:s,setActiveModalType:u,closeModal:x,providerDetails:y,onConversion:b}=e,{purchaseIntent:v}=(0,h.useCopperClient)(),{data:C}=(0,f.default)("deferred-auto-recharge-config",{fallbackData:null}),[j,S]=(0,t.useState)("initializing"),{team:M}=(0,d.useTeam)(),{user:A}=(0,c.useUser)(),{mutate:B}=(0,k.useSWRConfig)(),{account:N}=(0,m.useAccount)(),{balance:I,hasEverPaid:R}=(0,i.useAiCreditsBalance)(),T=(0,o.useToasts)(),{resolvedTheme:$}=(0,O.useTheme)(),E=(0,t.useMemo)(()=>K(v),[v]),z=(0,t.useRef)(null),D=(0,t.useCallback)(async()=>{try{if(S("in_progress"),!M||!A||!v||!y||void 0===I||void 0===E)return void S("ready");if(z.current){let e=await z.current();if(e.success){await _({purchaseIntentId:v.id,teamIdOrSlug:M.id}),T.success(`Successfully added $${E} to your AI Gateway Credits balance!`);let e=Number(I)+E;if(b?.({amount:E,newBalance:e,autoRechargeConfig:C??void 0}),await B(`/api/ai/ai-credits-balance?teamId=${M.id}`,()=>({cumulativeBalance:e,hasEverPaid:!0}),{revalidate:!1}),C)try{let{minimumBalance:e,targetBalance:a,maximumMonthlySpend:t}=C;await P({teamIdOrSlug:M.id,minimumBalance:e,targetBalance:a,maximumMonthlySpend:t}),B(`/api/credit-topups?teamId=${M.id}&currency=ai_gateway_credits`),B("deferred-auto-recharge-config",null,{revalidate:!1}),T.success("Auto-reload has been enabled!")}catch(e){T.error("Payment successful, but auto-reload setup failed. Please try setting it up again.")}S("completed"),x()}else{g.analytics.track(p.AnalyticsEvent.AI_CREDITS_CHECKOUT_ERROR,{message:e.error??"Payment checkout failed"}),T.error(e.error??"Failed to add credits. Please try again."),S("ready");return}}else{g.analytics.track(p.AnalyticsEvent.AI_CREDITS_CHECKOUT_ERROR,{message:"Payment handler not initialized"}),T.error("We're having trouble processing your payment. Please try again."),S("ready");return}}catch(e){T.error("We're having trouble processing your payment. Please try again."),S("ready"),x(),g.analytics.track(p.AnalyticsEvent.AI_CREDITS_CHECKOUT_ERROR,{message:e.message})}},[A,M,N,v,B,S,y,T,x,E,I,C,R,b]);return(0,a.jsxs)(l.Modal.Modal,{active:"checkout"===s,onClickOutside:x,children:[(0,a.jsxs)(l.Modal.Body,{children:[(0,a.jsxs)(l.Modal.Header,{children:[(0,a.jsx)(l.Modal.Title,{children:"Confirm Payment Method"}),(0,a.jsx)(l.Modal.Subtitle,{children:"Your default payment method will be used for a one-time charge unless you add a new payment method below."})]}),"initializing"===j?(0,a.jsx)(w.Skeleton,{className:"h-32",width:"100%"}):null,(0,a.jsx)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial",children:y?(0,a.jsx)(U.CopperPaymentElement,{confirmHandler:z,clientSecret:y.clientSecret,options:{elementsOptions:{appearance:(n={theme:"stripe"},{theme:"flat",variables:{fontSizeBase:"14px",fontSizeSm:"14px",colorTextPlaceholder:(r="dark"===$)?"hsl(240, 3.8%, 60%)":"hsl(240, 3.8%, 46.1%)",colorText:r?"white":"rgb(9, 9, 11)",colorPrimary:"var(--blue-700)",colorDanger:"hsl(0, 84.2%, 60.2%)",borderRadius:"6px",colorBackground:r?"black":"white",focusBoxShadow:r?"rgb(255, 255, 255) 0px 0px 0px 0px, rgb(161, 161, 170) 0px 0px 0px 1px, rgba(0, 0, 0, 0.05) 0px 1px 2px 0px":"rgb(0, 0, 0) 0px 0px 0px 0px, rgb(161, 161, 170) 0px 0px 0px 1px, rgba(0, 0, 0, 0.05) 0px 1px 2px 0px"},rules:{".Input":{border:r?"1px solid hsl(240, 5.9%, 30%)":"1px solid hsl(240, 5.9%, 90%)",padding:"10px 12px",transition:"all cubic-bezier(0.4, 0, 0.2, 1) 150ms"},".Label":{marginBottom:"8px",color:r?"#999999":"#666666",lineHeight:"20px",fontWeight:"400"},".AccordionItem":{backgroundColor:r?"black":"white"},".Block":{backgroundColor:r?"black":"white"}},...n}),loader:"never",savedPaymentMethod:{enableRedisplay:"auto"}}},onReady:()=>S("ready")}):null}),(0,a.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial -mx-6 -mb-6 mt-6 px-6 py-4 pt-6 border-t bg-background-200",children:[(0,a.jsx)(L,{}),(0,a.jsx)(G,{purchaseIntent:v})]})]}),(0,a.jsx)("div",{className:"flex flex-col items-stretch justify-start flex-initial px-6 py-2 border-t bg-background-200",children:(0,a.jsx)(H,{purchaseIntent:v})}),(0,a.jsxs)(l.Modal.Actions,{children:[(0,a.jsx)(l.Modal.Action,{onClick:()=>{u("top_up"),S("initializing")},type:"secondary",children:"Back"}),(0,a.jsx)(l.Modal.Action,{onClick:async()=>{await D()},loading:["in_progress","initializing"].includes(j),children:"Confirm and Pay"})]})]})}function F(e){let{activeModalType:r,setActiveModalType:n,closeModal:s,providerDetails:u,onConversion:x}=e,{purchaseIntent:y}=(0,h.useCopperClient)(),{data:b}=(0,f.default)("deferred-auto-recharge-config",{fallbackData:null}),[v,C]=(0,t.useState)("ready"),{team:j}=(0,d.useTeam)(),{user:S}=(0,c.useUser)(),{mutate:M}=(0,k.useSWRConfig)(),{account:A}=(0,m.useAccount)(),{balance:w,hasEverPaid:B}=(0,i.useAiCreditsBalance)(),N=(0,o.useToasts)(),I=(0,t.useMemo)(()=>K(y),[y]),R=(0,t.useCallback)(async()=>{if(j&&S&&y&&u&&void 0!==w&&void 0!==I&&"in_progress"!==v)try{C("in_progress"),await T({purchaseIntentId:y.id,teamIdOrSlug:j.id}),await _({purchaseIntentId:y.id,teamIdOrSlug:j.id}),N.success(`Successfully added $${I} to your AI Gateway Credits balance!`);let e=Number(w)+I;if(x?.({amount:I,newBalance:e,autoRechargeConfig:b??void 0}),await M(`/api/ai/ai-credits-balance?teamId=${j.id}`,()=>({cumulativeBalance:e,hasEverPaid:!0}),{revalidate:!1}),b)try{let{minimumBalance:e,targetBalance:a,maximumMonthlySpend:t}=b;await P({teamIdOrSlug:j.id,minimumBalance:e,targetBalance:a,maximumMonthlySpend:t}),M(`/api/credit-topups?teamId=${j.id}&currency=ai_gateway_credits`),M("deferred-auto-recharge-config",null,{revalidate:!1}),N.success("Auto-reload has been enabled!")}catch(e){N.error("Payment successful, but auto-reload setup failed. Please try setting it up again.")}C("completed"),s()}catch(e){N.error("We're having trouble processing your payment. Please try again."),C("ready"),s(),g.analytics.track(p.AnalyticsEvent.AI_CREDITS_CHECKOUT_ERROR,{message:e.message})}},[S,j,A,y,M,C,v,u,N,s,I,w,b,B,x]);return(0,a.jsxs)(l.Modal.Modal,{active:"checkout"===r,onClickOutside:s,children:[(0,a.jsxs)(l.Modal.Body,{children:[(0,a.jsxs)(l.Modal.Header,{children:[(0,a.jsx)(l.Modal.Title,{children:"Confirm Purchase"}),(0,a.jsx)(l.Modal.Subtitle,{children:"Your purchase will be reported to AWS Markeplace for invoicing and payment."})]}),(0,a.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial -mx-6 -mb-6 mt-6 px-6 py-4 pt-6 border-t bg-background-200",children:[(0,a.jsx)(L,{}),(0,a.jsx)(G,{purchaseIntent:y})]})]}),(0,a.jsx)("div",{className:"flex flex-col items-stretch justify-start flex-initial px-6 py-2 border-t bg-background-200",children:(0,a.jsx)(H,{purchaseIntent:y})}),(0,a.jsxs)(l.Modal.Actions,{children:[(0,a.jsx)(l.Modal.Action,{onClick:()=>{n("top_up")},type:"secondary",children:"Back"}),(0,a.jsx)(l.Modal.Action,{onClick:async()=>{await R()},loading:"in_progress"===v,children:"Confirm and Pay"})]})]})}function G(e){let{purchaseIntent:i}=e,r=(0,t.useMemo)(()=>i?i.lineItems?.map(e=>({name:e.name,amount:Number(e.unitAmount)*Number(e.quantity)}))??[]:[],[i]),n=i?.tax?Number(i.tax):0,l=n>0;return(0,a.jsxs)("div",{className:"flex flex-col items-stretch justify-start flex-initial",children:[r.map((e,t)=>(0,a.jsxs)("div",{className:`flex flex-row items-stretch justify-between gap-4 flex-initial py-2 ${l||t<r.length-1?"border-b":""}`,children:[(0,a.jsx)("p",{className:"text-[14px] leading-[20px] font-medium text-gray-900",children:e.name}),(0,a.jsx)("p",{className:"text-[14px] leading-[20px] font-medium text-gray-900",children:`$${e.amount.toFixed(2)}`})]},e.name)),n>0?(0,a.jsxs)("div",{className:"flex flex-row items-stretch justify-between gap-4 flex-initial py-4 border-b",children:[(0,a.jsx)("p",{className:"text-[14px] leading-[20px] font-medium text-foreground",children:"Estimated Tax"}),(0,a.jsx)("p",{className:"text-[14px] leading-[20px] font-medium text-foreground",children:`$${n.toFixed(2)}`})]}):null]})}function H(e){let{purchaseIntent:t}=e,i=t?.total?Number(t.total):0;return(0,a.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-1 flex-initial py-2",children:[(0,a.jsxs)("div",{className:"flex flex-row items-stretch justify-between gap-4 flex-initial",children:[(0,a.jsx)("p",{className:"text-[14px] leading-[20px] font-medium text-foreground",children:"Total"}),(0,a.jsx)("p",{className:"text-[14px] leading-[20px] font-medium text-foreground",children:`$${i.toFixed(2)}`})]}),(0,a.jsx)("p",{className:"text-label-12 text-gray-900 text-right",children:"* Plus applicable tax and fees"})]})}function L(){return(0,a.jsxs)("p",{className:"text-copy-14 text-gray-900",children:['By pressing "Confirm and Pay" and accessing AI Gateway, you agree to'," ",(0,a.jsx)(R.Link,{href:"/legal/ai-product-terms",className:"text-foreground underline",target:"_blank",children:"Vercel's AI Product Terms."})]})}function W(e){var t;let{isUpdatedStripeElementsEnabled:i}=e,{purchaseIntent:r,providerDetails:n}=(0,h.useCopperClient)();return(t=r,t?.provider?.type==="tackle_aws_marketplace")?(0,a.jsx)(F,{...e,providerDetails:n}):i?(0,a.jsx)(D,{...e,providerDetails:n}):(0,a.jsx)(z,{...e,providerDetails:n})}function K(e){return e?e.lineItems?.filter(e=>"AI Gateway Credits"===e.name).reduce((e,a)=>e+Number(a.unitAmount)*(Number(a.quantity)||1),0):0}var V=e.i(8158658),Y=e.i(2471070);function q(){let{topups:e,loading:a,mutate:t}=(0,Y.useAiGatewayCreditTopups)(),i=e?.find(e=>"orb_ledger"!==e.provider.type||"miu"!==e.provider.currency);return{autoRechargeConfig:i?{minimumBalance:i.minimumBalance,targetBalance:i.targetBalance,maximumMonthlySpend:i.maximumMonthlySpend??""}:void 0,loading:a,mutate:t}}e.s(["useAiCreditsAutoRecharge",0,q],9602070);var J=e.i(3500331),Q=e.i(1906681);let X=(0,y.createServerReference)("400b4bc27e17b1a7da90fbec0c7fea1b3a4dfcd561",y.callServer,void 0,y.findSourceMapURL,"deleteAutoTopupConfig"),Z=(0,y.createServerReference)("40c14b01d58d1c3136d1dc4eb5972ce2553a85b57a",y.callServer,void 0,y.findSourceMapURL,"updateAutoTopupConfig"),ee=(0,y.createServerReference)("4050cdb7b2579ff8a55412f3cba8351b213bda7783",y.callServer,void 0,y.findSourceMapURL,"get30DaySpend"),ea=u.z.object({minimumBalance:u.z.string().refine(e=>!Number.isNaN(Number(e))&&Number.isInteger(Number(e))&&Number(e)>=5,{message:"Minimum balance must be a whole number and at least $5"}),targetBalance:u.z.string().refine(e=>!Number.isNaN(Number(e))&&Number.isInteger(Number(e))&&Number(e)>=25,{message:"Target balance must be a whole number and at least $25"}),maximumMonthlySpend:u.z.string().optional().refine(e=>!e||!Number.isNaN(Number(e))&&Number.isInteger(Number(e))&&Number(e)>=50,{message:"Maximum monthly spend must be a whole number and at least $50"})}).refine(e=>{let{minimumBalance:a,targetBalance:t}=e;return Number(t)>Number(a)},{message:"Target balance must be greater than minimum balance",path:["targetBalance"]});function et(e){let{autoRechargeConfig:a,draftAutoRechargeConfig:t,type:i}=e;return t?t[i]??"":a?a[i]??"":"minimumBalance"===i?"5":"targetBalance"===i?"25":"maximumMonthlySpend"===i?"50":"0"}function ei(e){let{autoRechargeConfig:n,onCancel:l,onComplete:s}=e,{data:c,mutate:u}=(0,f.default)("deferred-auto-recharge-config",{fallbackData:null}),m=n??c??void 0,[p,g]=(0,t.useState)(!!m),[x,h]=(0,t.useState)(null),[y,b]=(0,t.useState)("ready"),[v,C]=(0,t.useState)({}),{balance:j,hasEverPaid:S}=(0,i.useAiCreditsBalance)(),{recommendedMinBalance:M}=function(){let{team:e,isReady:a}=(0,d.useTeam)(),{data:t,isLoading:i,error:r}=(0,f.default)(e?.slug&&a?`ai-gateway-spend-${e.slug}`:null,async()=>e?.slug?ee({teamSlug:e.slug}):0);return{recommendedMinBalance:void 0!==t?Math.min(Math.max(Math.ceil(.3*t),5),500):void 0,monthlySpend:t,isLoading:!a||i,error:r}}(),A=!!m!==p||null!==x,{team:w}=(0,d.useTeam)(),{mutate:B}=(0,k.useSWRConfig)(),N=(0,o.useToasts)(),I=function(e){let{autoRechargeConfig:a,draftAutoRechargeConfig:t}=e;return(e,i)=>({minimumBalance:"minimumBalance"===e?i:et({autoRechargeConfig:a,draftAutoRechargeConfig:t,type:"minimumBalance"}),targetBalance:"targetBalance"===e?i:et({autoRechargeConfig:a,draftAutoRechargeConfig:t,type:"targetBalance"}),maximumMonthlySpend:"maximumMonthlySpend"===e?i:et({autoRechargeConfig:a,draftAutoRechargeConfig:t,type:"maximumMonthlySpend"})})}({autoRechargeConfig:m,draftAutoRechargeConfig:x}),R=(0,t.useCallback)(async()=>{if(!w||!x)return;let{minimumBalance:e,targetBalance:a,maximumMonthlySpend:t}=x;S?(await P({teamIdOrSlug:w.id,minimumBalance:e,targetBalance:a,maximumMonthlySpend:t??""}),B(`/api/credit-topups?teamId=${w.id}&currency=ai_gateway_credits`),N.success("Successfully enabled auto-reload!")):(u({minimumBalance:e,targetBalance:a,maximumMonthlySpend:t??""}),N.success("Auto-reload will be enabled after your first purchase."))},[w,x,B,N,S,u]),_=(0,t.useCallback)(async()=>{if(!w||!n||!x)return;let{maximumMonthlySpend:e,minimumBalance:a,targetBalance:t}=x;await Z({teamIdOrSlug:w.id,updatedMaximumMonthlySpend:e??"",updatedMinimumBalance:a,updatedTargetBalance:t}),B(`/api/credit-topups?teamId=${w.id}&currency=ai_gateway_credits`),N.success("Successfully updated auto-reload!")},[w,n,x,B,N]),T=(0,t.useCallback)(async()=>{w&&n&&(await X({teamIdOrSlug:w.id}),B(`/api/credit-topups?teamId=${w.id}&currency=ai_gateway_credits`),N.success("Successfully disabled auto-reload!"))},[w,n,B,N,X]),$=(0,t.useCallback)(async()=>{if(b("in_progress"),!A)return void b("ready");let e=ea.safeParse({minimumBalance:et({autoRechargeConfig:m,draftAutoRechargeConfig:x,type:"minimumBalance"}),targetBalance:et({autoRechargeConfig:m,draftAutoRechargeConfig:x,type:"targetBalance"}),maximumMonthlySpend:et({autoRechargeConfig:m,draftAutoRechargeConfig:x,type:"maximumMonthlySpend"})});if(!e.success){b("ready");let a={};e.error.errors.forEach(e=>{a[e.path[0]]=e.message}),C(a);return}if(void 0!==j&&Number(e.data.minimumBalance)>=Number(j)&&!0===S){b("ready"),C({minimumBalance:"Minimum balance must be lower than your current balance"});return}if(void 0!==M&&Number(e.data.minimumBalance)<M){b("ready"),C({minimumBalance:`Based on your usage, $${M} is recommended`});return}C({});try{m&&!p?n?await T():u(null):!n&&x?await R():n&&x&&await _(),b("completed"),s?.()}catch{N.error("Failed to update auto-reload. Please try again."),b("ready")}},[n,x,p,m,R,_,T,u,N,A,s,j,b,C,S,M]);return(0,a.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial",children:[(0,a.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial",children:[(0,a.jsxs)("div",{className:"flex flex-row items-center justify-between gap-2 flex-initial",children:[(0,a.jsx)("p",{className:"text-[14px] leading-[20px] font-medium",children:"Auto-reload"}),(0,a.jsx)(Q.Toggle,{"aria-label":"Enable Auto-reload",checked:p,size:"large",onChange:()=>{g(e=>{let a=!e;return a&&h({minimumBalance:(M??5).toString(),targetBalance:"25",maximumMonthlySpend:""}),C({}),a})}})]}),(0,a.jsxs)("div",{className:"flex flex-row items-stretch justify-start gap-4 flex-initial",children:[(0,a.jsx)(J.Input,{"aria-labelledby":"balance-trigger-label",label:"When balance falls below",width:"100%",suffix:"USD",value:et({autoRechargeConfig:m,draftAutoRechargeConfig:x,type:"minimumBalance"}),onChange:e=>{h(()=>I("minimumBalance",e.target.value)),v.minimumBalance&&C(e=>({...e,minimumBalance:void 0}))},disabled:!p,suffixStyling:!1,error:v.minimumBalance}),(0,a.jsx)(J.Input,{"aria-labelledby":"balance-reload-label",label:"Recharge to target balance",width:"100%",suffix:"USD",value:et({autoRechargeConfig:m,draftAutoRechargeConfig:x,type:"targetBalance"}),onChange:e=>{h(()=>I("targetBalance",e.target.value)),v.targetBalance&&C(e=>({...e,targetBalance:void 0}))},disabled:!p,suffixStyling:!1,error:v.targetBalance})]}),(0,a.jsx)("div",{className:"flex flex-col items-stretch justify-start flex-initial",children:(0,a.jsx)(J.Input,{"aria-labelledby":"max-spend-label",label:"Maximum monthly spend",width:"100%",suffix:"USD",placeholder:et({autoRechargeConfig:m,draftAutoRechargeConfig:x,type:"maximumMonthlySpend"}),value:et({autoRechargeConfig:m,draftAutoRechargeConfig:x,type:"maximumMonthlySpend"}),onChange:e=>{h(()=>I("maximumMonthlySpend",e.target.value)),v.maximumMonthlySpend&&C(e=>({...e,maximumMonthlySpend:void 0}))},disabled:!p,suffixStyling:!1,error:v.maximumMonthlySpend})})]}),(0,a.jsxs)("div",{className:"flex flex-row items-stretch justify-end gap-2 flex-initial",children:[l?(0,a.jsx)(r.Button,{type:"secondary",onClick:l,size:"small",children:"Cancel"}):null,(0,a.jsx)(r.Button,{onClick:$,loading:"in_progress"===y,disabled:!A,size:"small",children:"Save Changes"})]})]})}e.s(["AutoRechargeForm",0,ei],1080526);var er=e.i(7553931);function en(e){let{activeModalType:t,setActiveModalType:i,autoRechargeConfig:r}=e,n=(0,er.useParams)(),o="string"==typeof n?.teamSlug?n.teamSlug:void 0,{topups:d}=(0,Y.useAiGatewayCreditTopups)(),c=d?.some(e=>"orb_ledger"===e.provider.type&&"miu"===e.provider.currency)??!1;return(0,a.jsxs)(l.Modal.Modal,{active:"auto_recharge"===t,onClickOutside:()=>i(null),children:[(0,a.jsxs)(l.Modal.Body,{children:[(0,a.jsx)(l.Modal.Header,{children:(0,a.jsx)(l.Modal.Title,{children:"Enable Auto-reload"})}),c&&o?(0,a.jsx)(s.Note,{fill:!0,children:(0,a.jsxs)("p",{className:"text-copy-14",children:["Buy with MIU is enabled for AI Gateway. Auto-reload is managed in your"," ",(0,a.jsx)(R.Link,{href:`/${o}/~/settings/billing#plan`,variant:"highlight",children:"billing settings"}),"."]})}):(0,a.jsx)(ei,{autoRechargeConfig:r,onCancel:()=>i("top_up"),onComplete:()=>i("top_up")})]}),c&&(0,a.jsx)(l.Modal.Actions,{children:(0,a.jsx)(l.Modal.Action,{type:"secondary",onClick:()=>i("top_up"),children:"Back"})})]})}var el=e.i(3089600),es=e.i(2166755),eo=e.i(7837522),ed=e.i(7780974);let ec=(0,t.createContext)(null);e.s(["AddCreditsModalProvider",0,function(e){let{children:r,isUpdatedStripeElementsEnabled:n,isAutoRechargeEnabled:l}=e,{openModal:s,closeModal:o,modals:c}=function(e){let{isUpdatedStripeElementsEnabled:r,isAutoRechargeEnabled:n}=e,{data:l,mutate:s}=(0,f.default)("modal:ai-credits",{fallbackData:null}),o=(0,t.useRef)(void 0),{track:c,isReady:u}=(0,eo.useTrackActivity)(),[p,g]=(0,t.useState)(void 0),{autoRechargeConfig:x}=q(),{balance:y}=(0,i.useAiCreditsBalance)(),{team:b}=(0,d.useTeam)(),{account:v}=(0,m.useAccount)(),C=(0,es.useEnvironment)(v),S=(0,t.useRef)(null);(0,el.default)("modal",(e,a)=>{"top-up"===e&&g(`modal-query${a?.source?`.${a.source}`:""}`)},["source"]);let M=(0,t.useCallback)(e=>{o.current=e,s("top_up"),c(ed.VercelActivityAction.AiGatewayAddCreditsModalOpened,{source:e,previousBalance:y,autoRechargeConfig:x})},[c,y,x,s]);(0,t.useEffect)(()=>{p&&u&&(M(p),g(void 0))},[p,u,M]);let A=(0,t.useCallback)(()=>{s(null),S.current?.(),o.current=void 0},[s]),w=(0,t.useCallback)(e=>{c(ed.VercelActivityAction.AiGatewayAddCreditsModalCompleted,{source:o.current,previousBalance:y,...e,autoRechargeConfig:e.autoRechargeConfig??x})},[x,c,y]),B=(0,a.jsxs)(h.CopperProvider,{environment:C,teamIdOrSlug:b?.id,clearPaymentStateRef:S,children:[(0,a.jsx)(j,{activeModalType:l??null,setActiveModalType:s,closeModal:A,isAutoRechargeEnabled:n,autoRechargeConfig:x}),(0,a.jsx)(W,{activeModalType:l??null,setActiveModalType:s,closeModal:A,isUpdatedStripeElementsEnabled:r,onConversion:w}),(0,a.jsx)(V.default,{active:"add_card"===l,onAdded:()=>{s("checkout")},onCancel:()=>{s("checkout")}}),(0,a.jsx)(en,{activeModalType:l??null,setActiveModalType:s,autoRechargeConfig:x},JSON.stringify(x))]});return{openModal:M,closeModal:A,modals:B}}({isUpdatedStripeElementsEnabled:n,isAutoRechargeEnabled:l});return(0,a.jsxs)(ec.Provider,{value:{openModal:s,closeModal:o,modals:c},children:[r,c]})},"useAddCreditsModalContext",0,function(){let e=(0,t.useContext)(ec);if(!e)throw Error("useAddCreditsModalContext must be used within AddCreditsModalProvider");return e}],7612113)},231107,e=>{"use strict";var a=e.i(6695816),t=e.i(3089600);e.s(["useSourceFromParams",0,function(){let[e,i]=(0,a.useState)();return(0,t.default)("source",e=>{i(e)}),e}])},4375105,e=>{"use strict";var a=e.i(31889),t=e.i(2831393),i=e.i(2504781),r=e.i(5255926),n=e.i(5468328),l=e.i(6695816),s=e.i(6347389),o=e.i(7612113),d=e.i(1717203),c=e.i(7557283),u=e.i(5338940),m=e.i(4597921),p=e.i(231107),g=e.i(6468432);e.s(["ViewBalanceAndPurchaseCreditsModal",0,function(){let{type:e="inline"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},f=(0,p.useSourceFromParams)(),{can:x}=(0,d.default)(),h=x(c.Action.Update,c.Resource.PaymentMethod),{team:y,isReady:b}=(0,u.useTeam)(),{balance:v,hasEverPaid:C}=(0,t.useAiCreditsBalance)(),{openModal:j}=(0,o.useAddCreditsModalContext)(),S=y?.billing?.status==="overdue",M=(0,l.useCallback)(e=>{if(void 0===e)return"";let a=Math.max(0,e);return a<100?a.toFixed(2):a<1e3?a.toFixed(0):`${(a/1e3).toFixed(0)}k`},[]),A=(0,m.useServerFlag)("enable-ai-gateway-free-usage-insights",!1);return(0,g.isFlexibleCommitment)(y)?null:(0,a.jsx)("div",{className:"flex items-center gap-2",children:void 0!==v&&b?(0,a.jsx)(n.Tooltip,{position:"bottom",disableTriggers:h&&!S,boxAlign:"center",text:h?"AI Gateway credit purchases are disabled due to an overdue invoice.":"You need additional permissions to manage your team’s AI Gateway credit.",children:(0,a.jsx)(i.Button,{type:"on-demand"===e?"default":"secondary",size:"on-demand"===e?"small":void 0,disabled:!h||S,onClick:()=>j(f?`credits-button.${f}`:"credits-button"),prefix:"inline"===e?(0,a.jsx)(s.Coins,{}):void 0,children:"inline"===e?`${M(v)} ${A&&!1===C?"Free Credit":"Credit"}`:"Buy Credit"})}):(0,a.jsx)(r.Skeleton,{children:(0,a.jsx)(i.Button,{type:"on-demand"===e?"default":"secondary",size:"on-demand"===e?"small":void 0,prefix:"inline"===e?(0,a.jsx)(s.Coins,{}):void 0,children:"inline"===e?"Loading Credit":"Buy Credit"})})})}])},1912982,e=>{"use strict";var a=e.i(7909933),t=e.i(8042625),i=e.i(5338940);e.s(["usePurchaseIntentAggregate",0,function(){let{start:e,end:r,currency:n,configuration:l}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{team:s}=(0,i.useTeam)(),o="string"==typeof e?e:e?.toISOString(),d="string"==typeof r?r:r?.toISOString(),c=function(e){let{teamId:a,start:t,end:i,currency:r,configuration:n}=e,l={};if(a&&(l.teamId=a),t&&(l.start=t),i&&(l.end=i),l.property="subtotal",r&&(l.currency="string"==typeof r?r:String(r)),n&&"type"in n&&n.type&&(l["configuration.type"]="string"==typeof n.type?n.type:String(n.type),"options"in n&&n.options&&"currency"in n.options&&n.options.currency)){let e=n.options.currency;l["configuration.options.currency"]="string"==typeof e?e:String(e)}return l}({teamId:s?.id,start:o,end:d,currency:n,configuration:l}),{data:u,error:m,isLoading:p,mutate:g}=(0,a.default)(s?.id?`/api/purchase-intents/aggregate${(0,t.encode)(c)}`:null,async e=>{let a=await fetch(e);if(!a.ok)throw Error(a.statusText);return a.json()});return{count:u?.count,total:u?.total,loading:p,error:m,mutate:g}}])}]);

//# debugId=cfa57f2c-a41c-7ca0-409e-d8c1c02414a4
//# sourceMappingURL=4556ab2af01b16b7.js.map